<app-loading [condition]="isLoading"></app-loading>
<app-toast [message]="toast.message"></app-toast>


<!-- PRODUCT COMPONENT _________________________________________________________ -->
<div class="productsPage" *ngIf="!isLoading">
  <br>
  <h2 class="centerText">Products</h2>
  <!-- new product button-->

  <app-create-product [isEditing]="isCreateFormOpen"></app-create-product>
  <button *ngIf="authenticated" class="createProductButton largeBottomMargin" (click)="isCreateFormOpen = !isCreateFormOpen">Create product</button>



  <!-- Search component -->
  <div class="form-inline">
    <!-- name search -->
    <div class="searchFields smallBottomMargin">
      <input
      class="form-control"
      placeholder="Search for a product"
      [(ngModel)]="query"
      (keyup.enter)="searchFromBox()"
      type="text"
      >
      <!-- min search -->
      <input
      class="form-control"
      type="number"
      min="0"
      step="100"
      placeholder="min price"
      [(ngModel)]="minPrice"
      (keyup.enter)="searchFromBox()"
      >
      <!-- max search -->
      <input
      class="form-control"
      type="number"
      min="0"
      step="100"
      placeholder="max price"
      [(ngModel)]="maxPrice"
      (keyup.enter)="searchFromBox()"
      >
      <button (click)="searchFromBox()"><i class="fa fa-search"></i></button>
    </div>
  </div>

  <!-- Category filter. works outside of search, should be separated -->
  <select class="form-control smallBottomMargin"  [(ngModel)]="selectedCategory">
    <option selected value=".*" >--Select a category--</option>
    <option *ngFor="let c of categories" [ngValue]="c">{{c}}</option>
  </select>

  <div class="productsAllComponents">
    <div class="card-block" class="productsColumn">


      <!-- PRODUCT LIST -->
      <table class="table table-bordered table-striped">
        <thead class="thead-default">
          <tr>
            <!-- name, not selected -->
            <th *ngIf="!nameSelected" class="clickable" (click)="sortBy('name'); toggleNameSort()">NAME
              <i *ngIf="!ascName" class="fa fa-chevron-up" aria-hidden="true"></i>
              <i *ngIf="ascName" class="fa fa-chevron-down" aria-hidden="true"></i>
            </th>
            <!-- name, selected -->
            <th *ngIf="nameSelected" class="clickable bgOrange" (click)="sortBy('name'); toggleNameSort()">NAME
              <i *ngIf="!ascName" class="fa fa-chevron-up" aria-hidden="true"></i>
              <i *ngIf="ascName" class="fa fa-chevron-down" aria-hidden="true"></i>
            </th>
            <!-- price, not selected -->
            <th *ngIf="!priceSelected" class="clickable" (click)="sortBy('price'); togglePriceSort()">PRICE
              <i *ngIf="!ascPrice" class="fa fa-chevron-up" aria-hidden="true"></i>
              <i *ngIf="ascPrice" class="fa fa-chevron-down" aria-hidden="true"></i>
            </th>
            <!-- price, selected -->
            <th *ngIf="priceSelected" class="clickable bgOrange" (click)="sortBy('price'); togglePriceSort()">PRICE
              <i *ngIf="!ascPrice" class="fa fa-chevron-up" aria-hidden="true"></i>
              <i *ngIf="ascPrice" class="fa fa-chevron-down" aria-hidden="true"></i>
            </th>
          </tr>
        </thead>
        <tbody *ngIf="filteredProducts.length === 0">
          <tr>
            <td colspan="4">There are no products in the DB. Add a new product below.</td>
          </tr>
        </tbody>
        <tbody *ngIf="!isEditing">
          <tr *ngFor="let product of filteredProducts" (click)="updateStyle($event); updateDetailView(product)"> <!-- Generates a tr for each product in the db. -->
            <td>{{product.name}}</td>
            <td>{{product.price}} NOK</td>
          </tr>
        </tbody>
      </table>

    </div>


    <!-- GOOGLE MAPS + card details (right column)________________________ -->
    <div class="rightColumn">
      <!-- Product details card -->
      <app-product-details [authenticated]="authenticated" [product]="productDetails.product" class="detailsCard"></app-product-details>
      <!-- Google maps Map -->
      <app-google-maps></app-google-maps>
    </div>


  </div>


  <!-- Pagination component -->
  <div>
  <app-pagination
    (goPage)="goToPage($event)"
    (goNext)="onNext()"
    (goPrev)="onPrev()"
    [pagesToShow]="totalPageNum"
    [page]="pageNum"
    [perPage]="listingsPerPage"
    [count]="totalListings"></app-pagination>
  </div>
</div>
